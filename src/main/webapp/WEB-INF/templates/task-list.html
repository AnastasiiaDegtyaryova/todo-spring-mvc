<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Task List</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body class="container mt-4">
<h1 class="mb-4">Task List</h1>

<a th:href="@{/tasks/new}" class="btn btn-primary mb-3">+ New Task</a>

<form method="get" th:action="@{/tasks}" class="row g-3 mb-3">
    <div class="col-auto">
        <input type="text" name="assignedTo" th:value="${assignedTo}" class="form-control" placeholder="Assigned to">
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-primary">Filter</button>
    </div>
</form>

<table class="table table-bordered table-striped mb-4">
    <thead>
    <tr>
    <tr>
        <th>
            <a th:href="@{/tasks(sortField='id', sortDir=${sortField=='id' && sortDir=='asc' ? 'desc' : 'asc'}, assignedTo=${assignedTo})}">
                ID
                <i th:if="${sortField == 'id'}"
                   class="bi"
                   th:classappend="${sortDir == 'asc'} ? ' bi-caret-up-fill' : ' bi-caret-down-fill'"></i>
            </a>
        </th>
        <th>
            <a th:href="@{/tasks(sortField='description', sortDir=${sortField=='description' && sortDir=='asc' ? 'desc' : 'asc'}, assignedTo=${assignedTo})}">
                Description
                <i th:if="${sortField == 'description'}"
                   class="bi"
                   th:classappend="${sortDir == 'asc'} ? ' bi-caret-up-fill' : ' bi-caret-down-fill'"></i>
            </a>
        </th>
        <th>
            <a th:href="@{/tasks(sortField='status', sortDir=${sortField=='status' && sortDir=='asc' ? 'desc' : 'asc'}, assignedTo=${assignedTo})}">
                Status
                <i th:if="${sortField == 'status'}"
                   class="bi"
                   th:classappend="${sortDir == 'asc'} ? ' bi-caret-up-fill' : ' bi-caret-down-fill'"></i>
            </a>
        </th>
        <th>
            <a th:href="@{/tasks(sortField='assignedTo', sortDir=${sortField=='assignedTo' && sortDir=='asc' ? 'desc' : 'asc'}, assignedTo=${assignedTo})}">
                Assigned To
                <i th:if="${sortField == 'assignedTo'}"
                   class="bi"
                   th:classappend="${sortDir == 'asc'} ? ' bi-caret-up-fill' : ' bi-caret-down-fill'"></i>
            </a>
        </th>
        <th>Actions</th>
    </tr>

    </tr>
    </thead>
    <tbody>
    <tr th:each="task : ${tasks}">
        <td th:text="${task.id}"></td>
        <td th:text="${task.description}"></td>
        <td th:text="${task.status}"></td>
        <td th:text="${task.assignedTo}"></td>
        <td>
            <a th:href="@{'/tasks/edit/' + ${task.id}}">Edit</a>
            |
            <a th:href="@{'/tasks/delete/' + ${task.id}}" onclick="return confirm('Are you sure?')">Delete</a>
        </td>
    </tr>
    </tbody>
</table>

<nav th:if="${totalPages > 1}">
    <ul class="pagination">

        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
            <a class="page-link"
               th:href="@{/tasks(page=${currentPage - 1}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, assignedTo=${assignedTo})}">
                «
            </a>
        </li>

        <li class="page-item"
            th:each="i : ${#numbers.sequence(1, totalPages)}"
            th:classappend="${i == currentPage} ? 'active'">
            <a class="page-link"
               th:href="@{/tasks(page=${i}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, assignedTo=${assignedTo})}"
               th:text="${i}"></a>
        </li>

        <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
            <a class="page-link"
               th:href="@{/tasks(page=${currentPage + 1}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, assignedTo=${assignedTo})}">
                »
            </a>
        </li>

    </ul>
</nav>

</body>
</html>
